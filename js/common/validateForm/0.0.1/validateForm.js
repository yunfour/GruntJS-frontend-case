/*! gruntTest 2015-01-26 */
define("common/validateForm/0.0.1/validateForm",["$"],function(a){var b=a("$"),c=function(a,c,d,e){var f=b(a),g=f.closest(".com-form-item"),h=g.find(".com-form-explain"),i=h.hasClass("com-form-explain-block");e=e||"&nbsp;",0===h.size()?(h=b('<div class="com-form-explain com-form-explain-hasIco"></div>'),h.appendTo(g)):(h.removeClass().addClass("com-form-explain com-form-explain-hasIco"),i&&h.addClass("com-form-explain-block")),c?(h.show(),"explain"===d?h.html('<i class="com-ico com-form-ico com-form-ico-explain"></i><span>'+e+"</span>"):""!==d&&h.addClass("com-form-explain-"+d).html('<i class="com-ico com-form-ico com-form-ico-'+d+'"></i><span>'+e+"</span>")):h.hide()},d=function(a,d){var e=b(a),f=(e.attr("name"),b.trim(e.val()));""===f&&d&&c(e,!0,"explain",d)},e=function(a,d,e){var f,g,h=b(a),i=h.attr("name"),j=b.trim(h.val()),k=(h.attr("type")||"").toLowerCase(),l=h.prop("tagName").toLowerCase(),m=(h.closest("div.com-form-item"),h.closest("form")),n=0;if(d){if(g="undefined"==typeof d.isShowSuccessTip?!0:!!d.isShowSuccessTip,h.data("is_pass_validate","false"),c(h,!1),d.required)if("text"===k||"password"===k||"hidden"===k||"textarea"===l||"select"===l)""===j&&(c(h,!0,"err",d.emptyTip||"该字段不能为空！"),n++);else if("radio"===k||"checkbox"===k){var o=m.find("input[name="+i+"]:checked");0===o.size()&&(c(h,!0,"err",d.emptyTip||"该字段不能为空！"),n++)}if(0===n&&d.compare){var p=m.find("input[name="+d.compare.fieldName+"],textarea[name="+d.compare.fieldName+"]").eq(0),q=b.trim(p.val());p.size()&&(d.compare.compareFn(j,q)||(c(h,!0,"err",d.compare.failedTip||""),n++))}if(f=d.patterns,0===n&&f&&f.constructor===Array)for(var r,s,t,u=0,v=f.length;v>u;u++)if(s=f[u],t=s.pattern,r=s.noMatchTip||"你输入的内容格式有误！",t.constructor===RegExp&&(t=function(a){return s.pattern.test(a)}),!t(j)){c(h,!0,"err",r),n++;break}if(0===n&&d.asyncVali){var w=h.data("valiXhr"),x=d.asyncVali,y=x.url,z={};z.fieldName=x.name||i,z.fieldVal=encodeURIComponent(j),z._r=Math.random(),w&&w.abort&&w.abort(),c(h,!0,"loading",""),h.data("is_pass_validate","asyncValidating"),w=b.getJSON(y,z,function(a){var b="1"===a.status;b?(g&&c(h,!0,"success",x.successTip||d.successTip||""),h.data("is_pass_validate","true")):(c(h,!0,"err",a.message||""),h.data("is_pass_validate","false")),"function"==typeof e&&e(b,a)}),h.data("valiXhr",w)}0!==n?(h.data("is_pass_validate","false"),"function"==typeof e&&e(!1)):d.asyncVali||(g&&c(h,!0,"success",d.successTip||""),h.data("is_pass_validate","true"),"function"==typeof e&&e(!0))}},f=function(a,b){var c,d,e=[];for(var f in b)d=!1,b.hasOwnProperty(f)&&(c=a.find("[name="+f+"]").eq(0),c.size()&&(d=c.data("is_pass_validate"),"true"!==d&&e.push(f)));return{isPass:0===e.length,notPassFieldsName:e}},g=function(a,b){var c;for(var d in b)b.hasOwnProperty(d)&&(c=a.find("[name="+d+"]").eq(0),c.size()&&"true"!==c.data("is_pass_validate")&&e(c,b[d]))};return{showExplain:c,showDefaultTip:d,valiFn:e,isPassVali:f,goVali:g}});