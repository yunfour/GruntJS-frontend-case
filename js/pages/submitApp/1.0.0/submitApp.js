/*! gruntTest 2015-01-26 */
define("pages/submitApp/1.0.0/setFrm",["$","common/validateForm/0.0.1/validateForm"],function(a){function b(){return{imgUrl:encodeURIComponent(c.trim(f.val())),appName:encodeURIComponent(c.trim(g.val())),kitName:encodeURIComponent(c.trim(h.val())),appType:encodeURIComponent(c.trim(i.val()))}}var c=a("$"),d=a("common/validateForm/0.0.1/validateForm"),e=c("#J-submitAppFrm"),f=c("#imgUrl"),g=c("#appName"),h=c("#kitName"),i=c("#appType"),j=e.find("input[type=submit]"),k={imgUrl:{required:!0,emptyTip:"请上传图标！"},appName:{required:!0,emptyTip:"请输入应用名称！"},appType:{patterns:[{pattern:function(a){var b="null"!==a;return b},noMatchTip:"请选择应用类型"}]}};e.delegate("input","blur",function(){var a=c(this),b=a.attr("name");d.valiFn(this,k[b])}),i.on("change",function(){var a=i,b=a.attr("name");d.valiFn(this,k[b])}),e.on("submit",function(){var a=function(){var a=d.isPassVali(e,k);return a.isPass||(d.goVali(e,k),a=d.isPassVali(e,k)),a.isPass};return j.hasClass("com-btn-disable")?!1:(d.showExplain(j,!1),a()&&(j.addClass("com-btn-disable").val("提交中..."),c.post("jsp/submitApp.jsp",b(),function(a){j.removeClass("com-btn-disable").val("提交"),"1"!==a.status?d.showExplain(j,!0,"warn",a.message):(d.showExplain(j,!0,"success","提交成功"),location.href="dev-submit-app-success.html")},"JSON")),!1)})}),define("pages/submitApp/1.0.0/submitApp",["$","./uploadAppIco","gallery/upload/1.1.1/upload","components/ToolTip/0.0.3/ToolTip","./setFrm","common/validateForm/0.0.1/validateForm"],function(a){a("$");a("./uploadAppIco"),a("./setFrm")}),define("pages/submitApp/1.0.0/uploadAppIco",["$","gallery/upload/1.1.1/upload","components/ToolTip/0.0.3/ToolTip"],function(a){function b(a){var b=/\.(jpg|jpeg|gif|png)$/i.test(a);return b}function c(a,b,c){if(e||(e=new h({theme:"red",arrowPosition:6}).render()),b){var d=a.offset();e.setTipText(c).position(d.left+a.outerWidth()/2,d.top-2).temporaryShow(2e3)}else e.hide()}function d(a,b,c){var d=k.find("i.com-form-ico"),e=k.find("span"),f="com-ico com-form-ico com-form-ico-";a?(k.removeClass("com-form-explain-warn").show(),f+=b,d.removeClass().addClass(f),e.html(c)):k.hide()}var e,f=a("$"),g=a("gallery/upload/1.1.1/upload"),h=a("components/ToolTip/0.0.3/ToolTip"),i=f("#J-uploadIcoBtn"),j=f("#J-selectIcoBtn"),k=f("#J-uploadExplain"),l=f("#imgUrl"),m=[],n=new g({trigger:j,name:"appImg",action:"./jsp/uplaodAppPic.jsp",accept:"image/*",multiple:!1,data:{r:Math.random()},change:function(a){c(j,!1),m=[],l.val("");for(var d,e=0,f=a.length;f>e;e++){if(d=a[e],!b(a[e].name))return c(j,!0,"请选择格式为JPG,PNG,GIF的文件"),!1;if(d.size&&d.size>5e5)return c(j,!0,"文件大小不能超过500k"),!1}m=a},error:function(){i.removeClass("com-btn-disable"),d(!0,"warn","上传出错，请重试")},success:function(a){var b=f.parseJSON(a);i.removeClass("com-btn-disable"),"1"===b.status?(d(!0,"success","上传成功"),l.val(b.imgUrl),j.html('<img src="'+b.imgUrl+'" width="125" height="125" style="border-radius: 5px;" />')):d(!0,"warn",b.message)},progress:function(){}});i.on("click",function(){return i.hasClass("com-btn-disable")?!1:0===m.length?(c(i,!0,"请选择图标文件"),!1):(i.addClass("com-btn-disable"),n.submit(),d(!0,"loading","正在上传中..."),void(m=[]))})});